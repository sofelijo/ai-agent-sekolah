<div class="row g-3 align-items-end">
    <div class="col-lg-4 col-md-4">
        <label class="form-label">Jenis Latihan</label>
        <select class="form-select" id="generateSubject" required>
            {% for subject in subjects %}
            <option value="{{ subject.id }}">{{ subject.name }} ({{ grade_labels[subject.grade_level]|default('Kelas 6 SD') }})</option>
            {% endfor %}
        </select>
    </div>
    <div class="col-lg-4 col-md-4">
        <label class="form-label">Kategori Mapel & Tingkat</label>
        <div class="d-flex gap-2">
            <select class="form-select" id="generateSection">
                <option value="matematika">Matematika</option>
                <option value="bahasa_pg">Bahasa Indonesia</option>
            </select>
            <select class="form-select" id="generateGrade">
                <option value="sd6">Kelas 6 SD</option>
                <option value="smp3">Kelas 3 SMP</option>
                <option value="sma">SMA</option>
            </select>
        </div>
    </div>
    <div class="col-lg-4 col-md-4">
        <label class="form-label">Topik</label>
        <input type="text" class="form-control" id="generateTopic" placeholder="Contoh: Bilangan pecahan" required>
    </div>
</div>
<div class="row g-3">
    <div class="col-12 d-flex justify-content-end">
        <button type="button" class="btn btn-primary" id="generateSubmitPro" data-generator-submit>
            <i class="bi bi-magic me-1"></i>Generate
        </button>
    </div>
</div>
<div class="row g-3 align-items-end">
    <div class="col-lg-4 col-md-4">
        <label class="form-label">Tipe Soal</label>
        <select class="form-select" id="generateQuestionType">
            <option value="direct" selected>Soal ringkas langsung</option>
            <option value="story">Soal cerita penalaran</option>
        </select>
    </div>
    <div class="col-lg-4 col-md-4">
        <label class="form-label">Format Jawaban</label>
        <select class="form-select" id="generateAnswerMode">
            <option value="multiple_choice" selected>Pilihan ganda saja</option>
            <option value="true_false">Benar / Salah saja</option>
            <option value="mix">Campuran (PG + Benar/Salah)</option>
        </select>
    </div>
    <div class="col-lg-4 col-md-4">
        <label class="form-label" id="generateDifficultyLabel">Kesulitan, Jumlah, & Soal/Stimulus</label>
        <div class="row g-2 align-items-end">
            <div class="col-4">
                <select class="form-select" id="generateDifficulty">
                    <option value="easy">Mudah</option>
                    <option value="medium">Sedang</option>
                    <option value="hard">Susah</option>
                </select>
            </div>
            <div class="col-4">
                <input type="number" class="form-control" id="generateAmount" min="1" max="20" value="1" placeholder="Jumlah stimulus">
            </div>
            <div class="col-4" id="generateBundleSizeGroup">
                <input type="number" class="form-control" id="generateBundleSize" min="3" max="5" step="1" value="3" placeholder="Soal per stimulus">
            </div>
        </div>
    </div>
</div>
<div class="col-12">
    <div class="d-flex justify-content-between align-items-center mb-1">
        <label for="generateExample" class="form-label mb-0">Contoh Soal / Instruksi</label>
        <div class="btn-group btn-group-sm" role="group">
            <button type="button" class="btn btn-outline-secondary" id="importJsonBtn" data-bs-toggle="tooltip" title="Import from JSON"><i class="bi bi-upload"></i></button>
            <button type="button" class="btn btn-outline-secondary" id="copyJsonTemplateBtn" data-bs-toggle="tooltip" title="Template JSON"><i class="bi bi-filetype-json"></i></button>
            <button type="button" class="btn btn-outline-info" id="exportPromptBtn" data-bs-toggle="tooltip" title="Export Prompt"><i class="bi bi-terminal"></i></button>
            <button type="submit" class="btn btn-primary" data-bs-toggle="tooltip" title="Generate"><i class="bi bi-magic me-1"></i>Generate</button>
        </div>
    </div>
    <div class="position-relative">
        <textarea class="form-control" id="generateExample" rows="2" placeholder="Tempelkan contoh soal, gaya cerita, atau instruksi lain yang diinginkan (opsional)"></textarea>
        <div class="position-absolute" style="bottom: 8px; right: 8px; width: 180px;">
            <label for="generateStyleSimilarity" class="form-label small mb-0">Tingkat Kemiripan</label>
            <select class="form-select form-select-sm" id="generateStyleSimilarity">
                <option value="30">30% · bebas berkreasi</option>
                <option value="50" selected>50% · seimbang</option>
                <option value="90">90% · sangat mirip</option>
            </select>
        </div>
    </div>
</div>
<div class="col-12" id="generatorStimulusSection">
    <div class="border rounded p-3">
        <div class="d-flex justify-content-between align-items-center mb-2 flex-wrap gap-2">
            <div>
                <label class="form-label mb-0">Pilih Stimulus untuk Mode Pro</label>
            </div>
            <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('main.latihan_tka_manual') }}" target="_blank" rel="noopener">
                <i class="bi bi-journal-text me-1"></i>Panduan Manual
            </a>
        </div>
        <div class="mb-3">
            <div class="btn-group w-100" role="group">
                <input type="radio" class="btn-check" name="stimulusUsage" id="stimulusUsageNone" value="none" checked>
                <label class="btn btn-outline-secondary" for="stimulusUsageNone">Tanpa Stimulus</label>
                <input type="radio" class="btn-check" name="stimulusUsage" id="stimulusUsageExisting" value="existing">
                <label class="btn btn-outline-secondary" for="stimulusUsageExisting">Pilih Stimulus</label>
                <input type="radio" class="btn-check" name="stimulusUsage" id="stimulusUsageNew" value="new">
                <label class="btn btn-outline-secondary" for="stimulusUsageNew">Buat Baru</label>
            </div>
        </div>
        <div class="mb-3 d-none" id="stimulusExistingFields">
            <label class="form-label">Pilih Stimulus</label>
            <div class="input-group mb-2">
                <input type="text" class="form-control" id="stimulusSearchInput" placeholder="Cari judul stimulus">
                <button type="button" class="btn btn-outline-secondary" id="refreshStimulusBtn">
                    <i class="bi bi-arrow-repeat"></i>
                </button>
            </div>
            <select class="form-select" id="questionStimulusSelect"></select>
            <div class="d-flex justify-content-end mt-2">
                <button type="button" class="btn btn-sm btn-outline-primary" id="openStimulusCreator">
                    <i class="bi bi-plus-circle"></i> Stimulus baru
                </button>
            </div>
            <div class="mt-3" id="selectedStimulusPreview">
                <div class="alert alert-light border mb-0">Pilih stimulus untuk melihat detailnya.</div>
            </div>
        </div>
        <div class="mb-3 d-none" id="stimulusCreatorFields">
            <label class="form-label">Buat Stimulus Baru</label>
            <textarea class="form-control mb-2" id="newStimulusBrief" rows="2" placeholder="Ringkasan singkat / catatan guru (opsional)"></textarea>
            <input type="text" class="form-control mb-2" id="newStimulusTitle" placeholder="Judul stimulus">
            <textarea class="form-control mb-2" id="newStimulusNarrative" rows="3" placeholder="Narasi panjang / cerita"></textarea>
            <label class="form-label">Gambar Pendukung (opsional)</label>
            <input type="file" class="form-control mb-2" id="newStimulusImage" accept="image/*">
            <textarea class="form-control" id="newStimulusImagePrompt" rows="2" placeholder="Deskripsi gambar atau prompt AI (opsional)"></textarea>
            <div class="d-flex gap-2 mt-2">
                <button type="button" class="btn btn-outline-secondary w-50" id="cancelStimulusCreator">Batal</button>
                <button type="button" class="btn btn-primary w-50" id="saveNewStimulus">Simpan Stimulus</button>
            </div>
        </div>
    </div>
</div>
<div class="col-md-6" id="generateStimulusImageGroup">
    <label class="form-label">Unggah gambar stimulus (opsional)</label>
    <input type="file" class="form-control" id="generateStimulusImage" accept="image/*">
</div>
<div class="col-md-6" id="generateImageDescriptionGroup">
    <label class="form-label">Deskripsi gambar / catatan visual</label>
    <textarea class="form-control" id="generateImageDescription" rows="2" placeholder="Contoh: Diagram batang literasi membaca kelas 6"></textarea>
</div>
